## Distributed tracing demo in Golang

The sample app contains product-services, which generates bunch of products for a given id. It uses db and analytic service to fetch products.To keep things simpler we simulated those services. 

![dependecy diagram generated by zipkin](https://cloud.githubusercontent.com/assets/13149921/20249059/77efdd14-a9f1-11e6-8cf4-d5b557307395.png)

This app can be used as standalone or more interestingly along with [catalog-service] (https://github.com/nklmish/java-distributed-tracing-demo) (distributed application) to see how we can trace along services developed in different languages.

## Dependencies
The project needs [open-zipkin] (https://github.com/openzipkin/docker-zipkin) and mongodb to be up and running. You can launch them locally via docker:
```
docker run -d -p 9411:9411 openzipkin/zipkin
```
```
docker run -p 27017:27017 -d mongo
```
Verify whether everything is up
```
docker ps
```
And you should see something like this
![running process](https://cloud.githubusercontent.com/assets/13149921/20248339/5e770592-a9e2-11e6-8859-bec9cdde2157.png)

## Install
```
go install
```

## Launch
```
cd $GOPATH/bin
```

```
./go-distributed-tracing-demo
```
## Override defaults
You can also override default parameters, please refer to help for more details i.e.
```
./go-distributed-tracing-demo --help
```
![available options to override](https://cloud.githubusercontent.com/assets/13149921/20248273/a5058e0e-a9e0-11e6-825f-7b7d52e69dfd.png)

Or if you are using Intellij, then you can override those parameter in run configuration.
![override options in intellij](https://cloud.githubusercontent.com/assets/13149921/20248430/525540ba-a9e4-11e6-823c-97bde58c45ad.png)

## Sample Request
```
curl -v http://localhost:8090/1 | jq .
```
```json
[
  {
    "name": "Product A-100"
  },
  {
    "name": "Product B-100"
  }
]
```

## Zipkin-UI

You can visit [localhost:9411] (http://localhost:9411) providing you are running zipkin locally and select go-product-service
![selecting-services](https://cloud.githubusercontent.com/assets/13149921/20249109/9f5779b0-a9f2-11e6-8680-87e86fb73a4f.png)

And dependending on randomness(check the source code) you will see either blue or yellow traces. The blue ones depicts traces without any problem and yellow ones depicts traces containing span with error logs

![Zipkin-ui](https://cloud.githubusercontent.com/assets/13149921/20249140/5f7eb456-a9f3-11e6-8942-d62d2805f3f3.png)

You can click a particular span to view more details 
![Detail view] (https://cloud.githubusercontent.com/assets/13149921/20249225/255891be-a9f5-11e6-9a34-2298936cf958.png)

## Error Spans
For ids >= 3 digits, application generates traces with error E.g.
```
curl -v http://localhost:8090/1000 | jq .
```

![error](https://cloud.githubusercontent.com/assets/13149921/20249333/9a6954dc-a9f7-11e6-8373-e9f8757622f2.png)
<br/>
You can click to find out more about error
![error-detail-view](https://cloud.githubusercontent.com/assets/13149921/20249345/db44dbf2-a9f7-11e6-972a-22294b0a2f0b.png)

